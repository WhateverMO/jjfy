问卷拆分逻辑是数据成熟度评估系统的核心组件，它将单独的问卷回答拆分为结构化模块以便进行评分和评估。该系统通过将问题组织成逻辑分组，实现了对数据成熟度不同方面的细粒度分析。

## 架构概述

拆分逻辑通过分层结构运行，其中问题被组织成模块，每个模块包含评估数据成熟度特定维度的相关问题。系统支持单选题和多选题，具有自动检测和相应的评分计算功能。

![[Pasted image 20251104165632.png]]

## 核心实现

### 模块结构定义

系统使用预定义的 `SECTION_INDICES` 数组将问题索引映射到模块 [question\_2.py](/data-maturity-assessment/back/eval/question_2.py#L52-L84)。该结构遵循特定模式：

1.  **问题1-45**：每组3个问题组成一个模块（15个模块）
2.  **问题46-62**：单独模块（17个模块）
3.  **问题63-79**：具有自定义分组的特殊模块
4.  **问题80-121**：每组3个问题组成一个模块（14个模块）
5.  **问题122-123**：配对模块
6.  **问题124-132**：每组3个问题组成一个模块（3个模块）

### 评分计算算法

`calculate_final_scores` 函数 [question\_2.py](/data-maturity-assessment/back/eval/question_2.py#L3-L51) 实现了核心评分逻辑：

-   **输入验证**：检查问题索引相对于问卷总长度的有效性
-   **总表单检测**：从单选题自动确定已完成的表单数量
-   **评分逻辑**：
    -   单选题：`base_score * (positive_responses / total_forms)`
    -   多选题：`(base_score * (total_responses / option_count)) / total_forms`

> [!NOTE]
> 系统使用从0开始的索引约定，因此问卷中的问题63对应代码中的索引62。这对于正确的模块映射至关重要。

## 模块类别

| 模块类型 | 问题范围 | 每模块问题数 | 总模块数 |
| --- | --- | --- | --- |
| 标准3问题模块 | 1-45, 80-121, 124-132 | 3 | 32 |
| 单独模块 | 46-62 | 1 | 17 |
| 特殊模块 | 63-79 | 可变 | 9 |
| 配对模块 | 122-123 | 2 | 1 |

## 与评估流水线的集成

拆分逻辑通过 `eval_qa` 函数 [eval.py](/data-maturity-assessment/back/eval/eval.py#L33-L43) 与主评估系统集成，该函数：

1.  使用 `split_questionnaire_counts_random` 拆分问卷计数
2.  计算每个问卷部分的权重
3.  使用BWM或熵方法处理权重
4.  应用部分索引进行基于模块的评分

## 数据流

![[Pasted image 20251104165720.png]]

> [!NOTE]
> 模块总分默认为100分，但可以通过 `calculate_final_scores` 函数中的 `module_total` 参数进行自定义。

## 使用示例

系统通常通过 `question_2_main.py` [question\_2\_main.py](/data-maturity-assessment/back/eval/question_2_main.py#L31-L35) 调用：

```python
scores = calculate_final_scores(questionnaire_counts, SECTION_INDICES)
```

这会产生一个模块分数列表，可进一步处理以进行权重计算和最终评估生成。

要深入了解这些分数在整体评估过程中的使用方式，请参考[评估流水线架构](深入探讨/核心评估引擎/评估流水线架构) 和[权重计算算法](深入探讨/核心评估引擎/权重计算方法) 。