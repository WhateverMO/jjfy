本系统中的权重聚合策略提供了将来自不同问卷、专家或评估方法的多个权重计算结果合并为统一且有意义的权重向量的方法。这些策略对于将多样化的评估输入整合到连贯的决策框架中至关重要。

## 架构概览

权重聚合系统通过多层方法运行，处理各个问卷的响应，应用特定的权重计算方法，然后跨不同维度聚合结果。系统支持 BWM（最佳-最差法）和熵权法计算，并提供灵活的聚合策略。

![[Pasted image 20251104164922.png]]

## 核心聚合方法

### 专家级聚合

实现的主要聚合策略是 BWM 方法中专家权重的**算术平均聚合**。当多位专家提供权重评估时，系统使用统计平均值将它们组合：

```python
aggregated_weights = np.mean(all_weights, axis=0)
aggregated_weights = aggregated_weights / np.sum(aggregated_weights)  # 重新归一化
```

这种方法确保每位专家的意见对最终权重向量贡献相等，并随后重新归一化以保持权重和约束 [weight\_calc\_method.py#L175-L177](/data-maturity-assessment/back/eval/weight_calc_method.py#L175-L177)。

> [!NOTE]
> 系统包含对失败专家计算的强大错误处理，即使部分专家数据无效，只要至少存在一个有效结果，聚合过程仍可继续。

### 分节聚合

`transpose_by_section` 函数实现了**跨问卷聚合策略**，按章节而非问卷重新组织权重结果：

```python
def transpose_by_section(weight_results):
    num_sections = len(weight_results[0])
    transposed = []
    for sec_idx in range(num_sections):
        sec_list = [weight_results[q_idx][sec_idx] for q_idx in range(len(weight_results))]
        transposed.append(sec_list)
    return transposed
```

这种转换支持跨所有问卷进行分节分析，便于在特定评估领域内进行对比研究和模式识别 [weight\_utils.py#L55-L74](/data-maturity-assessment/back/eval/weight_utils.py#L55-L74)。

## 方法选择与处理

`process_weight_list` 函数提供了**统一接口**，用于对聚合后的数据结构应用不同的权重计算方法：

| 方法 | 描述 | 用例 |
| --- | --- | --- |
| `bwm` | 带专家聚合的最佳-最差法 | 主观专家评估 |
| `entropy` | 熵权法 | 客观数据驱动的权重计算 |

该函数处理嵌套权重列表，处理类型转换（numpy.float64 转为 float），并在聚合管道中保持数据结构一致性 [weight\_calc\_method\_main.py#L11-L52](/data-maturity-assessment/back/eval/weight_calc_method_main.py#L11-L52)。

## 数据结构管理

聚合系统基于**三维数据结构**运行：

1.  **问卷层**：独立响应及其计算权重
2.  **分节层**：跨问卷的各章节聚合权重
3.  **方法层**：不同计算方法（BWM vs 熵权法）

## 与权重计算管道的集成

权重聚合策略与更广泛的权重计算生态系统紧密集成。聚合过程按以下顺序进行：

1.  **问卷处理**：使用 `split_questionnaire_counts_random` 分割和处理原始响应
2.  **独立权重计算**：每个问卷章节获得权重向量
3.  **跨节聚合**：结果按分节转置和聚合
4.  **方法应用**：使用选定的权重计算方法进行最终聚合

该管道确保聚合在多个层级发生，从个人专家意见到全面的分节摘要 [weight\_utils\_main.py#L130-L153](/data-maturity-assessment/back/eval/weight_utils_main.py#L130-L153)。

## 错误处理与健壮性

聚合系统包含全面的错误处理：

-   **专家验证**：失败的专家计算被记录并排除在聚合之外
-   **数据一致性**：类型转换防止下游处理中的 numpy 特定问题
-   **空数据保护**：验证检查防止处理无效或空数据集
-   **归一化保护**：自动重新归一化确保聚合后权重向量保持有效

## 后续步骤

有关特定权重计算方法的详细实现，请参考：

-   [BWM 方法实现](深入探讨/权重计算方法/BWM方法实现) 了解主观基于专家的权重计算
-   [熵权法](深入探讨/权重计算方法/熵权法) 了解客观数据驱动的权重确定

要了解这些聚合权重如何集成到更广泛的评估系统中，请参见[评估管道架构](深入探讨/核心评估引擎/评估流水线架构) 。